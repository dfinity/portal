---
keywords: [intermediate, dfx, load balancing, migration]
---

import { MarkdownChipRow } from "/src/components/Chip/MarkdownChipRow";

# Canister migration

<MarkdownChipRow labels={["Intermediate"]} />

# Overview

*Canister migration* refers to moving a canister (called the "migrated" canister) from one subnet (called "source" subnet) to another subnet (called "target" subnet).
This tutorial covers migrating the canister state (WASM, main and stable memory, etc.), cycles, and canister ID (principal).
Transient state (canister logs and history) and cycles reserved for storage cannot be migrated from one subnet to another.

The target subnet must contain a canister (called the "replaced" canister) that is used as a placeholder throughout canister migration.
For instance, this canister can be created using [`dfx canister create`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-create).

# Canister State Migration

The canister state of the migrated canister must first be captured by [creating a canister snapshot](/docs/building-apps/canister-management/snapshots/#creating-a-snapshot).

The canister snapshot can then be downloaded to a local file directory using [`dfx canister snapshot download`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-snapshot-download).

Next the canister snapshot can be uploaded to the replaced canister using [`dfx canister snapshot upload`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-snapshot-upload).

Finally the canister snapshot can be [loaded](/docs/tutorials/developer-liftoff-rust/level-3/3.3-canister-snapshots/#loading-a-snapshot) to the replaced canister.

The loaded canister snapshot of the replaced canister must be deleted using [`dfx canister snapshot delete`](/docs/tutorials/developer-liftoff-rust/level-3/3.3-canister-snapshots/#deleting-a-snapshot) before proceeding with canister ID migration (see below).
It is recommended to preserve the snapshot of the migrated canister (and also its copy in a local file directory) to facilitate disaster recovery.

# Canister Cycles Migration

**WARNING**: Make sure to create a snapshot of the migrated canister before proceeding with the following commands since they will destroy the canister state.

To prepare for cycles migration, we first uninstall the migrated canister using [`dfx canister uninstall-code`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-uninstall-code) and then we deploy the cycles wallet (WASM) to the migrated canister using [`dfx identity deploy-wallet`](/docs/building-apps/developer-tools/dfx/dfx-identity#dfx-identity-deploy-wallet).

To actually migrate cycles from the migrated canister, we start the migrated canister using [`dfx canister start`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-start) and then we use [`dfx canister deposit-cycles`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-deposit-cycles) specifying the migrated canister as `--wallet` and the replaced canister as the canister to which cycles should be deposited.

Make sure to leave at least 10T cycles in the migrated canister to pay for canister ID migration (described in the next section) and additionally enough cycles to pay for the migrated canister's resource consumption up until its canister ID migration. You can check out the migrated canister's resource cycles consumption as "idle" cycles consumption (per day) using [`dfx canister status`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-status).

# Canister ID migration

To prepare for canister ID migration, we stop both the migrated and replaced canisters using [`dfx canister stop`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-stop).

Then we can kick off canister ID migration using [`dfx canister migrate-id`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-migrate-id) specifying the migrated canister ID as the canister ID to migrate and the replaced canister ID as `--replace`.

Canister ID migration is expected to take at least 6 minutes. You can check out its status using [`dfx canister migration-status`](/docs/building-apps/developer-tools/dfx/dfx-canister#dfx-canister-migration-status).
